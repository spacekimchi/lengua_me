<h1><%= @passage.title %></h1>

<%
  # Prepare sentences data as an array of objects with content and optional audio_url
  sentences_data = @sentences.map do |sentence|
    {
      content: sentence.content,
      audio_url: (sentence.audio.attached? ? url_for(sentence.audio) : nil),
      order_idx: sentence.order_idx
    }
  end
%>

<!-- Main container for the Stimulus controller -->
<div data-controller="sentence-writer"
     data-sentences="<%= sentences_data.to_json %>"
     data-current-index="0">

  <!-- Target element where each sentence (card) will be rendered -->
  <div data-sentence-writer-target="writerContainer" class="card-container"></div>

  <textarea data-sentence-writer-target="textArea"></textarea>
  <div>
    <button data-sentence-writer-target="checkButton"
            data-action="click->sentence-writer#check">
            Check
    </button>
    <button data-sentence-writer-target="skipButton"
            data-action="click->sentence-writer#skip">
            Skip
    </button>
  </div>

  <div data-sentence-writer-target="checkResult">
  </div>

  <div class="card-navigation">
    <button data-sentence-writer-target="prevButton"
            data-action="click->sentence-writer#prev">
      Previous
    </button>
    <button data-sentence-writer-target="nextButton"
            data-action="click->sentence-writer#next">
      Next
    </button>
  </div>
</div>


<div>
  <%= @sentences.map(&:content).join("\n") %>
</div>
